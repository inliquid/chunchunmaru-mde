"use strict";function chunchunmaru(t,n){if(void 0===t)throw"First parameter (container id) cannot be null.";n=n||{};var e,n=this.settings=Object.assign({attributes:{id:"chunchunmaru-textarea",name:"chunchunmaru-textarea",placeholder:"Start writting!"},atLink:!1,atLinkBase:"https://github.com/",autoSave:!1,gfm:!0,livePreview:!1,livePreviewContainer:"",previewCodeHighlight:!1,sanitize:!0,saveHTML:!1,toolbar:["bold","italic","strikethrough","|","link","blockquote","code","image","|","center","ol","ul","|","h1","h2","h3","h4","h5","h6","|","undo","redo"]},n);if(this.regexs={atLink:/@(\w+)/g,email:/(\w+)@(\w+)\.(\w+)\.?(\w+)?/g,emailLink:/(mailto:)?([\w\.\_]+)@(\w+)\.(\w+)\.?(\w+)?/g,emoji:/:([\w\+-]+):/g,emojiDatetime:/(\d{2}:\d{2}:\d{2})/g,twemoji:/:(tw-([\w]+)-?(\w+)?):/g,pageBreak:/^\[[=]{8,}\]$/},this.loadScript=function(t,e,i){i=i||"body",e=e||function(){};var a=document.createElement("script");a.type="text/javascript",a.src=t,a.setAttribute("async",""),"Microsoft Internet Explorer"==navigator.appName&&"8."==navigator.appVersion.match(/8./i)?a.onreadystatechange=function(){a.readyState&&("loaded"!==a.readyState&&"complete"!==a.readyState||(a.onreadystatechange=null,e()))}:a.onload=function(){e()},("body"===i?document.getElementsByTagName("body")[0]:document.body).appendChild(a)},this.loadCSS=function(t,e,i){i=i||"head",e=e||function(){};var a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.onload=a.onreadystatechange=function(){e()},a.href=t,("head"===i?document.getElementsByTagName("head")[0]:document.body).appendChild(a)},this.loadScript("https://code.iconify.design/1/1.0.7/iconify.min.js"),n.livePreview&&(this.previewContainer=document.querySelector(this.settings.livePreviewContainer)),"undefined"!=typeof marked){if(n.previewCodeHighlight&&"undefined"==typeof hljs)throw"highlight.js is not defined";var i=new marked.Renderer,a=this.regexs.atLink,r=this.regexs.email;i.paragraph=t=>n.atLink?t=a.test(t)?(t=t.replace(r,function(t,e,i,a){return t.replace(/@/g,"_#_&#64;_#_")})).replace(a,function(t,e){return'<a href="'+n.atLinkBase+e+'" title="&#64;'+e+'" class="at-link">'+t+"</a>"}).replace(/_#_&#64;_#_/g,"@"):t:t;i=this.markedOptions={gfm:n.gfm,tables:!0,breaks:!0,pedantic:!1,smartLists:!0,smartypants:!1,highlight:!!n.previewCodeHighlight&&function(t,e){e=hljs.getLanguage(e)?e:"plaintext";return hljs.highlight(t,{language:e}).value},langPrefix:n.previewCodeHighlight?"hljs lang-":"lang-"};marked.setOptions(i)}if(n.sanitize){if("undefined"==typeof DOMPurify)throw"DOMPurify is not defined";DOMPurify.addHook("uponSanitizeElement",(t,e)=>{if("iframe"===e.tagName){const i=t.getAttribute("src")||"";if(!i.startsWith("https://www.youtube.com/embed/"))return t.parentNode.removeChild(t)}})}for(e in this.container=document.getElementById(t),this.toolbar=document.createElement("div"),this.textarea=this.container.getElementsByTagName("textarea")[0]||document.createElement("textarea"),n.attributes){var o=n.attributes[e];this.textarea.getAttribute(e)||this.textarea.setAttribute(e,o)}this.container.className+=" chunchumaru-container",this.toolbar.className+=" chunchunmaru-editor-toolbar",this.textarea.className+=" chunchunmaru-editor";t=this.container.children[0];this.container.appendChild(this.toolbar),void 0===t?this.container.appendChild(this.textarea):this.container.appendChild(t);var s=[""],l=[];this.triggerUndo=function(){1<s.length&&(l.push(this.textarea.value),this.textarea.value=s.pop())},this.triggerRedo=function(){l.length&&(s.push(this.textarea.value),this.textarea.value=l.pop())},this.hotkeys={b:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.bold.action()},i:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.italic.action()},l:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.link.action()},q:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.blockquote.action()},k:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.code.action()},g:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.image.action()},o:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.ol.action()},u:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.ul.action()},z:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.undo.action()},y:t=>{!t.ctrlKey||t.shiftKey||t.altKey||this.buttons.redo.action()}},this.hotkeys=Object.assign(this.hotkeys,n.hotkeys),this.textarea.addEventListener("keyup",t=>{t.key in this.hotkeys&&(!t.ctrlKey||t.shiftKey||t.altKey||(t.preventDefault(),this.hotkeys[t.key](t))),t.ctrlKey||t.shiftKey||t.altKey||"Tab"===t.key&&this.insertString("\t"),n.livePreview&&(this.previewContainer.innerHTML=this.getHTML())}),this.textarea.addEventListener("keydown",t=>{var e=t.key;if(" "!==e&&"Backspace"!==e&&"Delete"!==e||(l.length&&(l=[]),20<s.length&&s.shift(),s.push(this.textarea.value)),"Tab"===e&&t.preventDefault(),!t.shiftKey&&!t.altKey&&t.ctrlKey){switch(e){case"z":case"y":t.preventDefault()}t.key in this.hotkeys&&t.preventDefault()}});var h=this.buttons={bold:{action:()=>{this.wrapSelection("**","**")},icon:"mdi mdi-format-bold",name:"format_bold",title:"Bold selection Ctrl + B"},italic:{action:()=>{this.wrapSelection("_","_")},icon:"mdi mdi-format-italic",name:"format_italic",title:"Italic selection Ctrl + I"},strikethrough:{action:()=>{this.wrapSelection("~~","~~")},icon:"mdi mdi-format-strikethrough-variant",name:"format_strikethrough",title:"Strikethorugh selection"},link:{action:()=>{this.wrapSelection("[","](put_your_link_url_here)")},icon:"mdi mdi-link-variant",name:"link",title:"Add link Ctrl + L"},blockquote:{action:()=>{this.addPrefixToSelectedLine("> ")},icon:"mdi mdi-format-quote-close",name:"format_quote",title:"Blockquote Ctrl + Q"},code:{action:()=>{this.wrapSelection("```python\n","\n```")},icon:"mdi mdi-code-braces",name:"code",title:"Code sample Ctrl + K"},image:{action:()=>{this.wrapSelection("![image](",")","put_your_image_url_here")},icon:"mdi mdi-image",name:"image",title:"Image Ctrl + G"},uploadImage:{action:()=>{this.wrapSelection("![image](",")")},icon:"mdi mdi-image-plus",name:"add_photo_alternate",title:"Upload Image"},center:{action:()=>{this.wrapSelection("<div align='center'>\n\n","\n\n</div>")},icon:"mdi mdi-format-align-center",name:"format_align_center"},ol:{action:()=>{this.addOrderToSelectedLine()},icon:"mdi mdi-format-list-numbered",name:"format_list_numbered",title:"Numbered List Ctrl + O"},ul:{action:()=>{this.addPrefixToSelectedLine("- ")},icon:"mdi mdi-format-list-bulleted",name:"format_list_bulleted",title:"Bulleted List Ctrl + U"},h1:{action:()=>{this.addPrefixToSelectedLine("# ")},icon:"mdi mdi-format-header-1",name:"title"},h2:{action:()=>{this.addPrefixToSelectedLine("## ")},icon:"mdi mdi-format-header-2",name:"title"},h3:{action:()=>{this.addPrefixToSelectedLine("### ")},icon:"mdi mdi-format-header-3",name:"title"},h4:{action:()=>{this.addPrefixToSelectedLine("#### ")},icon:"mdi mdi-format-header-4",name:"title"},h5:{action:()=>{this.addPrefixToSelectedLine("##### ")},icon:"mdi mdi-format-header-5",name:"title"},h6:{action:()=>{this.addPrefixToSelectedLine("###### ")},icon:"mdi mdi-format-header-6",name:"title"},undo:{action:()=>{this.triggerUndo()},icon:"mdi mdi-undo",name:"undo",title:"Undo Ctrl + Z"},redo:{action:()=>{this.triggerRedo()},icon:"mdi mdi-redo",name:"redo",title:"Redo Ctrl + Y"}};this.initToolbar=()=>{var t,e,i,a;for(t of this.settings.toolbar)t in h?(e=h[t],(i=document.createElement("span")).className+="iconify toolbar-button-icon ",i.setAttribute("data-icon",e.icon.slice(4)),i.setAttribute("data-inline","false"),(a=document.createElement("button")).onclick=e.action,a.title=e.title,a.type="button",a.appendChild(i),this.toolbar.appendChild(a)):"|"===t&&((a=document.createElement("hr")).setAttribute("role","separator"),a.setAttribute("aria-orientation","vertical"),a.className+="toolbar-button-divider",this.toolbar.appendChild(a));this.toolbar.addEventListener("click",()=>{n.livePreviewContainer&&(this.previewContainer.innerHTML=this.getHTML())})},this.initToolbar(),n.livePreview&&(this.previewContainer.innerHTML=this.getHTML())}chunchunmaru.prototype.wrapSelection=function(t,e,i=""){var a=this.textarea,n=a.value,r=a.selectionStart,o=a.selectionEnd;let s=i;if(r!==o){s=n.substring(r,o);let t=s.replace(/\s*$/,"").length;s.length!==t&&(o=(r=a.selectionStart)+t,s=n.substring(r,o)),t=s.replace(/^\s*/,"").length,s.length!==t&&(r=(o=a.selectionEnd)-t,s=n.substring(r,o))}i=t+s+e,e=n.substring(0,r),a=n.substring(o,a.value.length);this.textarea.value=e+i+a,this.textarea.selectionStart=r+t.length+s.length,this.textarea.selectionEnd=r+t.length+s.length},chunchunmaru.prototype.insertString=function(t){var e=this.textarea.value,i=this.textarea.selectionStart,a=e.substring(0,i),e=e.substring(i,e.length);this.textarea.value=a+t+e,this.textarea.selectionStart=i+t.length,this.textarea.selectionEnd=i+t.length},chunchunmaru.prototype.addPrefixToSelectedLine=function(t){var e=this.textarea,i=e.selectionStart,a=e.selectionEnd;if(i==a){var n=e.value.substr(0,i).split("\n").length-1;(s=e.value.split("\n"))[n]=t+s[n]}else{var r=e.value.substr(0,i).split("\n").length-1,o=e.value.substr(0,a).split("\n").length-1,s=e.value.split("\n");for(o<r&&(e=o,o=r,r=e);r<=o;)s[r]=t+s[r],r+=1}this.textarea.value=s.join("\n")},chunchunmaru.prototype.addOrderToSelectedLine=function(){var t=this.textarea,e=t.selectionStart,i=t.selectionEnd,a=1;if(e==i){var n=t.value.substr(0,e).split("\n").length-1;(s=t.value.split("\n"))[n]=`${a}. `+s[n]}else{var r=t.value.substr(0,e).split("\n").length-1,o=t.value.substr(0,i).split("\n").length-1,s=t.value.split("\n");for(o<r&&(t=o,o=r,r=t);r<=o;)s[r]=`${a}. `+s[r],r+=1,a+=1}this.textarea.value=s.join("\n")},chunchunmaru.prototype.saveMarkdownToInnerHTML=function(){this.textarea.innerHTML=this.textarea.value},chunchunmaru.prototype.getHTML=function(){var t=marked(this.textarea.value);return this.settings.sanitize?DOMPurify.sanitize(t):t},chunchunmaru.markdownToHTML=function(t,e){if(e=e||{},e=Object.assign({gfm:!0,previewCodeHighlight:!1,sanitize:!0},e),"undefined"==typeof marked)throw"marked is not defined";var i=!1;if(e.previewCodeHighlight){if("undefined"==typeof hljs)throw"hljs is undefined";i=function(t,e){e=hljs.getLanguage(e)?e:"plaintext";return hljs.highlight(t,{language:e}).value}}if(e.sanitize&&"undefined"==typeof DOMPurify)throw"DOMPurify is not defined";i=this.markedOptions={gfm:e.gfm,tables:!0,breaks:!0,pedantic:!1,smartLists:!0,smartypants:!1,highlight:i,langPrefix:e.previewCodeHighlight?"hljs lang-":"lang-"};marked.setOptions(i);t=marked(t);return e.sanitize?DOMPurify.sanitize(t):t},"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports=chunchunmaru:window.chunchunmaru=chunchunmaru;