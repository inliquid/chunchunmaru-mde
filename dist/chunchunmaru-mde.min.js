"use strict";function chunchunmaru(e,a){if(e===undefined){throw"First parameter, container id, cannot be null."}a=a||{};var t={attributes:{id:"chunchunmaru-textarea",name:"chunchunmaru-textarea",placeholder:"Start writting!"},autoSave:false,gfm:true,livePreview:false,livePreviewContainer:"",previewCodeHighlight:false,sanitize:true,saveHTML:false,toolbars:["bold","italic","|","link","blockquote","code","image","|","center","ol","ul","|","h1","h2","h3","h4","h5","h6","|","undo","redo"]};var a=this.settings=Object.assign(t,a);if(a.livePreview){this.previewContainer=document.querySelector(this.settings.livePreviewContainer);if(typeof marked==="undefined"){throw"marked is not defined"}if(a.previewCodeHighlight){if(typeof hljs==="undefined"){throw"highlight.js is not defined"}}var i=this.markedOptions={gfm:a.gfm,tables:true,breaks:true,pedantic:false,smartLists:true,smartypants:false,highlight:a.previewCodeHighlight?function(e,t){const i=hljs.getLanguage(t)?t:"plaintext";return hljs.highlight(e,{language:i}).value}:false,langPrefix:a.previewCodeHighlight?"hljs lang-":"lang-"};marked.setOptions(i)}if(a.sanitize){if(typeof DOMPurify==="undefined"){throw"DOMPurify is not defined"}DOMPurify.addHook("uponSanitizeElement",(e,t)=>{if(t.tagName==="iframe"){const i=e.getAttribute("src")||"";if(!i.startsWith("https://www.youtube.com/embed/")){return e.parentNode.removeChild(e)}}})}this.container=document.getElementById(e);this.toolbar=document.createElement("div");this.textarea=this.container.getElementsByTagName("textarea")[0]||document.createElement("textarea");for(var r in a.attributes){var n=a.attributes[r];if(!this.textarea.getAttribute(r)){this.textarea.setAttribute(r,n)}}this.container.className+="chunchumaru-container";this.toolbar.className+="chunchunmaru-editor-toolbar";this.textarea.className+="chunchunmaru-editor";this.container.appendChild(this.toolbar);this.container.appendChild(this.textarea);this.addBracketToSelection=(e,t)=>{var i=this.textarea;var a=i.value;var r=i.selectionStart;var n=i.selectionEnd;var o=window.getSelection().toString();var s=e+o+t;var l=a.substring(0,r);var h=a.substring(n,i.value.length);this.textarea.value=l+s+h;this.textarea.focus();this.textarea.selectionStart=r+e.length+o.length;this.textarea.selectionEnd=r+e.length+o.length};this.insertString=e=>{var t=this.textarea.value;var i=this.textarea.selectionStart;var a=t.substring(0,i);var r=t.substring(i,t.length);this.textarea.value=a+e+r;this.textarea.selectionStart=i+e.length;this.textarea.selectionEnd=i+e.length};this.addPrefixToSelectedLine=e=>{var t=this.textarea;var i=t.selectionStart;var a=t.selectionEnd;if(i==a){var r=t.value.substr(0,i).split("\n");r[r.length-1]=e+r[r.length-1]}else{var n=t.value.substr(0,i).split("\n").length-1;var o=t.value.substr(0,a).split("\n").length-1;var r=t.value.split("\n");if(n>o){var s=o;o=n;n=s}while(n<=o){r[n]=e+r[n];n+=1}}this.textarea.value=r.join("\n");this.textarea.focus()};this.addOrderToSelectedLine=e=>{var t=this.textarea;var i=t.selectionStart;var a=t.selectionEnd;var r=1;if(i==a){var n=t.value.substr(0,i).split("\n");n[n.length-1]=r+n[n.length-1]}else{var o=t.value.substr(0,i).split("\n").length-1;var s=t.value.substr(0,a).split("\n").length-1;var n=t.value.split("\n");if(o>s){var l=s;s=o;o=l}while(o<=s){n[o]=`${r}. `+n[o];o+=1;r+=1}}this.textarea.value=n.join("\n");this.textarea.focus()};this.saveMarkdownToInnerHTML=()=>{this.textarea.innerHTML=this.textarea.value};this.getHTML=()=>{var e=marked(this.textarea.value);if(a.sanitize){var t=DOMPurify.sanitize(e);return t}else{return e}};this.markdownToHTML=e=>{var t=marked(e);if(a.sanitize){var i=DOMPurify.sanitize(t);return i}return t};var o=[""];var s=[];var l=20;this.hotkeys={b:e=>{if(e.ctrlKey){this.addBracketToSelection("**","**")}},i:e=>{if(e.ctrlKey){this.addBracketToSelection("*","*")}},Tab:e=>{if(!e.ctrlKey&&!e.shiftKey&&!e.altKey){this.insertString("    ")}}};this.hotkeys=Object.assign(this.hotkeys,a.hotkeys);this.triggerUndo=()=>{if(o.length>1){s.push(this.textarea.value);this.textarea.value=o.pop()}};this.triggerRedo=()=>{if(s.length){o.push(this.textarea.value);this.textarea.value=s.pop()}};this.textarea.addEventListener("keyup",e=>{if(e.key in this.hotkeys){this.hotkeys[e.key](e)}if(a.livePreview){this.previewContainer.innerHTML=this.getHTML()}this.textarea.innerHTML=this.textarea.value});this.textarea.addEventListener("keydown",e=>{const t=e.key;if(t===" "||t==="Backspace"||t==="Delete"){if(s.length){s=[]}if(o.length>l){o.shift()}o.push(this.textarea.value)}if(e.ctrlKey&&t==="z"){e.preventDefault();this.triggerUndo()}if(e.ctrlKey&&t==="y"){e.preventDefault();this.triggerRedo()}if(t==="Tab"){e.preventDefault()}});var h={bold:{action:()=>{this.addBracketToSelection("**","**")},icon:"mdi mdi-format-bold"},italic:{action:()=>{this.addBracketToSelection("*","*")},icon:"mdi mdi-format-italic"},link:{action:()=>{this.addBracketToSelection("[link_","](put_your_link_url_here)")},icon:"mdi mdi-link-variant"},blockquote:{action:()=>{this.addPrefixToSelectedLine("> ")},icon:"mdi mdi-format-quote-close"},code:{action:()=>{this.addBracketToSelection("```python\n","\n```")},icon:"mdi mdi-code-braces"},image:{action:()=>{this.addBracketToSelection("![image_","](put_your_image_url_here)")},icon:"mdi mdi-image"},center:{action:()=>{this.addBracketToSelection("<div align='center'>\n\n","\n\n</div>")},icon:"mdi mdi-format-align-center"},ol:{action:()=>{this.addOrderToSelectedLine()},icon:"mdi mdi-format-list-numbered"},ul:{action:()=>{this.addPrefixToSelectedLine("- ")},icon:"mdi mdi-format-list-bulleted"},h1:{action:()=>{this.addPrefixToSelectedLine("# ")},icon:"mdi mdi-format-header-1"},h2:{action:()=>{this.addPrefixToSelectedLine("## ")},icon:"mdi mdi-format-header-2"},h3:{action:()=>{this.addPrefixToSelectedLine("### ")},icon:"mdi mdi-format-header-3"},h4:{action:()=>{this.addPrefixToSelectedLine("#### ")},icon:"mdi mdi-format-header-4"},h5:{action:()=>{this.addPrefixToSelectedLine("##### ")},icon:"mdi mdi-format-header-5"},h6:{action:()=>{this.addPrefixToSelectedLine("###### ")},icon:"mdi mdi-format-header-6"},undo:{action:()=>{this.triggerUndo()},icon:"mdi mdi-undo"},redo:{action:()=>{this.triggerRedo()},icon:"mdi mdi-redo"}};this.initToolbar=()=>{var e=this.settings.toolbars;for(var t of e){if(t in h){var i=h[t];var a=document.createElement("i");a.className+="toolbar-button-icon "+i.icon;var r=document.createElement("button");r.onclick=i.action;r.type="button";r.appendChild(a);this.toolbar.appendChild(r)}else if(t==="|"){var n=document.createElement("hr");n.setAttribute("role","separator");n.setAttribute("aria-orientation","vertical");n.className+="toolbar-button-divider";this.toolbar.appendChild(n)}}};this.initToolbar();if(a.livePreview){this.previewContainer.innerHTML=this.getHTML()}}if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){module.exports=chunchunmaru}else{window.chunchunmaru=chunchunmaru}